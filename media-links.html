<!-- 
	Runtime:include this blurb at the bottom of your story. 
	Wrap words you want to appear as a popup with 
	<span class="media-link"></span>
	possible attributes:
	data-type="" - type of media. 
	data-url="" - url of image, document, etc.
	data-vid="" - id of video to pull in
	data-width="" - width of graphic, document, etc.
-->

<link href="/includes/js/css/jquery-ui-1.8.14.custom.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.14/jquery-ui.min.js"></script>
<script type="text/javascript" src="http://s3.documentcloud.org/notes/loader.js"></script>

<style type="text/css">
	.media-link  {color:#111; border-bottom: 1px dotted #111; background-color:#eee; padding:2px 5px; -webkit-transition: background-color .1s linear;	-moz-transition: background-color .1s linear; -o-transition: background-color .1s linear; -ms-transition: background-color .1s linear; transition: background-color .1s linear; }
	.media-link:hover {background-color:#D2DDEA; cursor:pointer;}

    /* Document Cloud styles */
    .DC-note { border:0px; -webkit-box-shadow:0px 0px 0px #fff; box-shadow:0px 0px 0px 0px #fff; }
    .DC-note .DC-note-title { text-align:left; font-size: 24px; font-family:"Georgia", "Times New Roman", Times, serif;}
    .DC-note .DC-note-excerpt-wrap { border: 3px solid #FFE325; }

    /* Dialog Box Styles */
    .ui-dialog .ui-dialog-content {background-color:#fff;}
   	.ui-widget-overlay {background:#fff url(''); opacity: .70; filter:Alpha(Opacity=70);}
	div.ui-dialog.ui-widget.video-player div.ui-dialog-titlebar {display:none;}
	div.ui-dialog.ui-widget.video-player .ui-dialog-content {padding:5px 15px 15px 15px;}
	.ui-widget-content, .ui-resizable-w, .ui-resizable-e {background:#fff url('');}
	.ui-widget-content h3 {text-align:left; font-size:20px;}
	.ui-widget-content p.description {text-align:left; margin-bottom:10px;}
	.ui-widget-content p.close {margin-bottom:10px; font-family:'Arial', 'Helvetica', sans-serif; text-align:right; position:relative; }
	p.close img {display:inline; position: relative; top: 3px;}
    p.close a {font-weight:bold; color:#999;}	
</style>

<script type="text/javascript">
/* 
 * Media Links
 * Multimedia embeds for stories.
 * Author: Armand Emamdjomeh
 * Version: 0.5
 */ 

function mediaLink(type, url, wide, vid){
	// make sure the width is an integer, we'll need it at a couple points
	wide = parseInt(wide);

	// we need to calculate height for video embeds
	if(type === "video-youtube" || type === "video-vimeo" || type === "video-brightcove" || type === "video-vimeo") {
		var height = Math.floor(wide * 9 / 16);
	}

	// close button in the popup
	var embedString = '<p class="close"><a>CLOSE <img src="http://www.latimes.com/includes/projects/population/images/close_18px.png" /></a></p>';

	// ok, here's our big switch statement to determine what gets displayed for each content type
	switch (type) {
		case "graphic":
			embedString += '<img src="' + url + '" />';
			break;

		case "document":
		    var ids = dcEmbedParse(url);
		    var docID = ids[0];
		    var noteID = ids[1];
		    embedString += '<div class="DC-note-container" id="DC-note-'+ noteID + '"></div>';
		    embedString += '<p style="text-align:left; font-weight:bold; padding-left:10px;">Click image to view the full document.</p>'
		    docUrl = "http://www.documentcloud.org/documents/" + docID + "/annotations/" + noteID + ".js";			
		    break;

		case "video-brightcove":
			var linkBaseURL = document.URL;
			embedString += "<object id='myExperience207503375' class='BrightcoveExperience'><param name='bgcolor' value='#FFFFFF' /><param name='wmode' value='transparent' /><param name='autoStart' value='false' /><param name='sectionName' value ='/' /><param name='contentItemType' value ='embed' /><param name='omnitureServer' value='latimes.com' /><param name='omnitureAcct' value='tribglobal' /><param name='width' value='" + wide + "' /><param name='height' value='" + height + "' /><param name='playerID' value='782523707001' /><param name='playerKey' value='AQ~~,AAAAtkVbcwk~,5Rx45u37p7At4uUFYYBfI0whp8ObLWHD' /><param name='adServerURL' value='http://ad.doubleclick.net/pfadx/trb.latimes/hp' /><param name='additionalAdTargetingParams' value=';player=bc;pos=pre;vc=News;clip=71433116;sz=3x3;tile=13;ord=3083020945' /><param name='externalAds' value='true' /><param name='linkBaseURL' value='" + linkBaseURL + "' /><param name='isVid' value='true' /><param name='isUI' value='true' /><param name='dynamicStreaming' value='true' /><param name='showNoContentMessage' value='true' /><param name='@videoPlayer' value='ref:" + vid + "' /></object>";
			break;

		case "video-youtube":
			embedString += '<iframe width="' + wide + '" height="' + height + '" src="http://www.youtube.com/embed/' + vid + '?rel=0&autoplay=1" frameborder="0" allowfullscreen></iframe>';
			break;

		case "video-vimeo":
			embedString += "<iframe src='http://player.vimeo.com/video/" + vid + "?autoplay=1' width='" + wide + "' height='" + height + "' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>";
			break;

		case "video-ndn":
			embedString += "<iframe src='http://embed.newsinc.com/Single/iframe.html?WID=2&VID=" + vid + "&freewheel=91002&sitesection=latimes&height=551&width=425' height=551 width=980 frameborder=no scrolling=no noresize marginwidth=0px marginheight=0px></iframe>";
			break; 
	}
	// create the box to pop up
    var popUpBox = jQuery('<div></div>');
	
    var popUpWidth = wide + 30;

    jQuery(popUpBox).html(embedString);
    var dialogRight = (jQuery(window).width()-popUpWidth)/2;
    var dialogTop = (jQuery(window).height()-551)/2;

    jQuery(popUpBox).dialog({
        beforeClose: function(event, ui) { 
            jQuery(popUpBox).html('');
		    popUpBox.dialog('destroy');
		    embedString = "";
		    },
		dialogClass: 'video-player',
        modal:true,
        position: [dialogRight,dialogTop],
        resizable: false,
        show: 'slide',
        width: popUpWidth
    });

    if(type === 'video-brightcove') {
    	brightcove.createExperiences();
    } else if (type === 'document') {
	    dc.embed.loadNote(docUrl, {afterLoad: function(){jQuery('.DC-note-contents a').attr('target', '_blank')}});
    }

    // Reset all variables, and blow the dialog box contents away, mostly for IE. Also done in beforeClose function above. 
    jQuery('.ui-widget-overlay, p.close a').bind('click', function(){
        jQuery(popUpBox).html('');
		popUpBox.dialog('destroy');
		embedString = "";
		return false;
	});

    return false;
}

jQuery(document).ready(function(){
	jQuery('.media-link').bind('click', function(){
		$this = jQuery(this);
		var type = $this.attr('data-type');
		var url = $this.attr('data-url') || "";
		var wide = $this.attr('data-width') || "650";
		var vid = $this.attr('data-vid') || "";
		console.log(type + ', ' + url + ', ' + vid + ', ' + wide );
		mediaLink(type, url, wide, vid);
	});
});

var dcEmbedParse = function (url) {
    // https://www.documentcloud.org/documents/396423-san-bernardino-bankruptcty-report.html#document/p5/a63666
    if (!url) {
        return false;
    }
    var parts = /(\d+)[-\w]+.html#document\/p\d+\/a(\d+)/.exec(url);
    var docID = parts[1];
    var noteID = parts[2];
    return [docID, noteID];
}

function loadDocEmbed(url, embedString){

}
</script>